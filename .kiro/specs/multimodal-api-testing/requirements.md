# 多模态 API 功能完整度测试

## 1. 项目概述

本规范旨在全面测试 Orchids API 项目的多模态功能完整度，包括文本聊天、图像生成和视频生成三大核心功能。

## 2. 功能范围

### 2.1 文本聊天功能
- 支持 OpenAI 兼容的聊天接口
- 支持流式和非流式响应
- 支持多种模型选择
- 支持账号负载均衡

### 2.2 图像生成功能
- 支持根据文本提示生成图像
- 支持多种尺寸选择
- 返回图像 URL

### 2.3 视频生成功能
- 支持根据文本提示生成视频
- 支持多种尺寸选择
- 返回视频 URL

## 3. 用户故事

### 3.1 作为开发者，我希望能够测试文本聊天功能
**验收标准：**
- 能够发送文本消息并接收 AI 响应
- 支持流式和非流式两种响应模式
- 能够选择不同的 AI 模型
- 响应格式符合 OpenAI API 规范

### 3.2 作为开发者，我希望能够测试图像生成功能
**验收标准：**
- 能够通过 API 请求生成图像
- 能够指定图像尺寸
- 返回可访问的图像 URL
- 响应格式符合 OpenAI API 规范

### 3.3 作为开发者，我希望能够测试视频生成功能
**验收标准：**
- 能够通过 API 请求生成视频
- 能够指定视频尺寸
- 返回可访问的视频 URL
- 响应格式符合 OpenAI API 规范

### 3.4 作为开发者，我希望能够通过测试页面进行可视化测试
**验收标准：**
- 测试页面能够正常加载
- 能够通过 UI 界面测试所有三种功能
- 能够查看请求和响应结果
- 能够预览生成的图像和视频

## 4. 技术要求

### 4.1 API 端点
- `/v1/chat/completions` - 文本聊天
- `/v1/images/generations` - 图像生成
- `/v1/videos/generations` - 视频生成
- `/v1/models` - 模型列表

### 4.2 测试环境
- 服务器地址：http://192.168.1.201:3002
- 测试页面：http://192.168.1.201:3002/static/test.html

### 4.3 测试工具
- 自动化测试脚本（Go 语言）
- 手动测试（通过测试页面）
- API 测试工具（curl/Postman）

## 5. 已知问题

### 5.1 路由未注册
**问题描述：**
- 图像生成和视频生成的处理器方法已实现
- 但在 `cmd/server/main.go` 中未注册对应的路由
- 导致这两个功能无法通过 HTTP 访问

**影响范围：**
- `/v1/images/generations` 端点返回 404
- `/v1/videos/generations` 端点返回 404
- 测试页面的图像和视频生成功能无法使用

**修复方案：**
在 `cmd/server/main.go` 中添加以下路由注册：
```go
mux.HandleFunc("/v1/images/generations", h.HandleOpenAIImages)
mux.HandleFunc("/v1/videos/generations", h.HandleOpenAIVideos)
```

## 6. 测试计划

### 6.1 单元测试
- 测试各个处理器方法的逻辑正确性
- 测试请求参数验证
- 测试响应格式生成

### 6.2 集成测试
- 测试完整的 HTTP 请求-响应流程
- 测试账号负载均衡功能
- 测试错误处理和重试机制

### 6.3 端到端测试
- 通过测试页面进行手动测试
- 验证实际的图像和视频生成
- 验证用户体验流程

## 7. 成功标准

### 7.1 功能完整性
- 所有三个核心功能都能正常工作
- 所有 API 端点都能正确响应
- 测试页面能够完整使用所有功能

### 7.2 代码质量
- 所有测试用例通过
- 代码覆盖率达到 80% 以上
- 无严重的代码质量问题

### 7.3 文档完整性
- 测试报告完整记录所有测试结果
- 问题清单明确列出所有发现的问题
- 修复建议清晰可执行

## 8. 交付物

### 8.1 测试脚本
- 自动化测试脚本（Go 语言）
- 测试配置文件
- 测试数据文件

### 8.2 测试报告
- 功能测试报告
- 性能测试报告
- 问题清单和修复建议

### 8.3 代码修复
- 路由注册修复
- 其他发现的问题修复
- 代码优化建议
